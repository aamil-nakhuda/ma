<!DOCTYPE html>
<!-- saved from url=(0072)https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter11/# -->
<html lang="en" class="js fontawesome-i2svg-active fontawesome-i2svg-complete"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    

<!-- begin _includes/seo.html --><title>Practical Malware Analysis - Chapter 11 Lab Write-up : Jai Minton</title>
<meta name="description" content="This details reverse engineering activities and answers for labs contained in the book ‘Practical Malware Analysis’ by Michael Sikorski and Andrew Honig, which is published by No Starch Press.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Jai Minton">
<meta property="og:title" content="Practical Malware Analysis - Chapter 11 Lab Write-up">
<meta property="og:url" content="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter11/">


  <meta property="og:description" content="This details reverse engineering activities and answers for labs contained in the book ‘Practical Malware Analysis’ by Michael Sikorski and Andrew Honig, which is published by No Starch Press.">



  <meta property="og:image" content="https://www.jaiminton.com/assets/images/PMALabCHAPTER11.JPG">



  <meta name="twitter:site" content="@CyberRaiju">
  <meta name="twitter:title" content="Practical Malware Analysis - Chapter 11 Lab Write-up">
  <meta name="twitter:description" content="This details reverse engineering activities and answers for labs contained in the book ‘Practical Malware Analysis’ by Michael Sikorski and Andrew Honig, which is published by No Starch Press.">
  <meta name="twitter:url" content="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter11/">


    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://www.jaiminton.com/assets/images/PMALabCHAPTER11.JPG">
  

  



  <meta property="article:published_time" content="2021-06-05T00:00:00+00:00">



  <meta property="article:modified_time" content="2023-11-13T17:51:03+00:00">



  

  


<style type="text/css">svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;-webkit-box-sizing:border-box;box-sizing:border-box;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top left;transform-origin:top left}.fa-lg{font-size:1.3333333333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:solid .08em #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.fa-rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{-webkit-transform:scale(1,-1);transform:scale(1,-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1,-1);transform:scale(-1,-1)}:root .fa-flip-both,:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{-webkit-filter:none;filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}</style><link rel="canonical" href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter11/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://www.jaiminton.com",
      "logo": "https://www.jaiminton.com/assets/images/feature-logo.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "CyberRaiju",
      "url": "https://www.jaiminton.com",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="https://www.jaiminton.com/feed.xml" type="application/atom+xml" rel="alternate" title="Jai Minton Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->
<script src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/particles.js.download"></script>
<script>/* particlesJS.load(@dom-id, @path-json, @callback (optional)); */
  particlesJS.load('pixels', '/assets/particlesjs-config.json', function() {
  console.log('callback - particles.js config loaded');
  });</script>
<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="https://www.jaiminton.com/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.jaiminton.com/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.jaiminton.com/favicon-16x16.png">
<link rel="manifest" href="https://www.jaiminton.com/site.webmanifest">
<link rel="mask-icon" href="https://www.jaiminton.com/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta http-equiv="Content-Security-Policy" content="default-src &#39;self&#39; https://www.youtube-nocookie.com/;script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; https://platform.twitter.com/ https://www.youtube-nocookie.com/ https://static.cloudflareinsights.com/ https://www.google-analytics.com use.fontawesome.com https://googletagmanager.com https://www.googletagmanager.com https://platform.twitter.com/widgets.js;img-src &#39;self&#39; &#39;unsafe-inline&#39; https://www.hackthebox.eu https://cards-dev.twitter.com/ https://www.youtube-nocookie.com/;style-src &#39;self&#39; &#39;unsafe-inline&#39;;upgrade-insecure-requests">
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<meta http-equiv="X-Content-Type-Option" content="nosniff">
<meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains">
<!-- end custom head snippets -->

    
  <style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style></head>
  <body class="layout--single wide" style="margin-bottom: 201.625px;">
    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="https://www.jaiminton.com/"><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/rootdir.png" alt=""></a>
        
        <a class="site-title" href="https://www.jaiminton.com/">CyberRaiju</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://www.jaiminton.com/tags/">📗 Browse</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.jaiminton.com/categories/">📙 Categories</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.jaiminton.com/about/">❓ About Me/Privacy</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle" type="button" count="1" style="">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"><li class="masthead__menu-item">
              <a href="https://buymeacoff.ee/JaiMinton">☕ Buy me a coffee</a>
            </li></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope="" itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope="" itemtype="https://schema.org/ListItem">
          <a href="https://www.jaiminton.com/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope="" itemtype="https://schema.org/ListItem">
          <a href="https://www.jaiminton.com/categories/#tutorials" itemprop="item"><span itemprop="name">Tutorials</span></a>
          <meta itemprop="position" content="2">
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope="" itemtype="https://schema.org/ListItem">
          <a href="https://www.jaiminton.com/categories/#practicalmalwareanalysis" itemprop="item"><span itemprop="name">Practicalmalwareanalysis</span></a>
          <meta itemprop="position" content="3">
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Practical Malware Analysis - Chapter 11 Lab Write-up</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar">
  
  
    
      
        <img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/PMALab.JPG" alt="Practical Malware Analysis - Lab Write-Up">
      
      <h3>Practical Malware Analysis - Lab Write-Up</h3>
      <p>This details reverse engineering activities and answers for labs contained in the book ‘Practical Malware Analysis’ by Michael Sikorski and Andrew Honig, which is published by No Starch Press.</p>

      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox">
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">📌 Introduction</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/" class="">Start</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🔬 1. Basic Static Techniques</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter1/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter1/#lab-1-1" class="">Lab 1-1 (Lab01-01.exe and Lab01-01.dll)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter1/#lab-1-2" class="">Lab 1-2 (Lab01-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter1/#lab-1-3" class="">Lab 1-3 (Lab01-03.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter1/#lab-1-4" class="">Lab 1-4 (Lab01-04.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">💻 2. Malware Analysis in Virtual Machines</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter2/" class="">Start</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🏃 3. Basic Dynamic Analysis</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter3/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter3/#lab-3-1" class="">Lab 3-1 (Lab03-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter3/#lab-3-2" class="">Lab 3-2 (Lab03-02.dll)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter3/#lab-3-3" class="">Lab 3-3 (Lab03-03.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter3/#lab-3-4" class="">Lab 3-3 (Lab03-04.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🔩 4. A Crash Course in x86 Disassembly</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#levels-of-abstraction" class="">Levels of Abstraction</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#main-memory" class="">Main Memory</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#instructions" class="">Instructions</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#operands" class="">Opcodes and Endianness</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#registers" class="">Registers</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#simple-instructions" class="">Simple Instructions</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#simple-instructions" class="">The Stack</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#simple-instructions" class="">Conditionals</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#branching" class="">Branching</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#rep-instructions" class="">Rep Instructions</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter4/#c-main-methods-and-offsets" class="">C Main Methods and Offsets</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🎊 5. IDA Pro</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter5/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter5/#lab-5-1" class="">Lab 5-1 (Lab05-01.dll)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🎐 6. Recognizing C Code Constructs in Assembly</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter6/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter6/#lab-6-1" class="">Lab 6-1 (Lab06-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter6/#lab-6-2" class="">Lab 6-2 (Lab06-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter6/#lab-6-3" class="">Lab 6-3 (Lab06-03.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter6/#lab-6-4" class="">Lab 6-4 (Lab06-04.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">👹 7. Analyzing Malicious Windows Programs</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter7/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter7/#lab-7-1" class="">Lab 7-1 (Lab07-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter7/#lab-7-2" class="">Lab 7-2 (Lab07-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter7/#lab-7-3" class="">Lab 7-3 (Lab07-03.exe and Lab07-03.dll)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🐛 8. Debugging</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter8/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter8/#source-level-vs-assembly-level-debuggers" class="">Source-Level vs. Assembly-Level Debuggers</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter8/#kernel-vs-user-mode-debugging" class="">Kernel vs. User-Mode Debugging</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter8/#using-a-debugger" class="">Using a Debugger</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter8/#exceptions" class="">Exceptions</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter8/#modifying-execution-with-a-debugger" class="">Modifying Execution with a Debugger</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter8/#modifying-program-execution-in-practice" class="">Modifying Program Execution in Practice</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🪲 9. OllyDbg</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter9/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter9/#lab-9-1" class="">Lab 9-1 (Lab09-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter9/#lab-9-2" class="">Lab 9-2 (Lab09-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter9/#lab-9-3" class="">Lab 9-3 (Lab09-03.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🌠 10. Kernel Debugging with WinDbg</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter10/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter10/#useful-windbg-commands" class="">Useful Windbg Commands</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter10/#lab-10-1" class="">Lab 10-1 (Lab10-01.exe and Lab10-01.sys)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter10/#lab-10-2" class="">Lab 10-2 (Lab10-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter10/#lab-10-3" class="">Lab 10-3 (Lab10-03.exe and Lab10-03.sys)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">📡 11. Malware Behavior</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter11/" class="active">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter11/#lab-11-1" class="">Lab 11-1 (Lab11-01.exe and Lab11-01.sys)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter11/#lab-11-2" class="">Lab 11-2 (Lab11-02.dll and Lab11-02.ini)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter11/#lab-11-3" class="">Lab 11-3 (Lab11-03.exe and Lab11-03.dll)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">👽 12. Covert Malware Launching</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter12/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter12/#lab-12-1" class="">Lab 12-1 (Lab12-01.exe and Lab12-01.dll)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter12/#lab-12-2" class="">Lab 12-2 (Lab12-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter12/#lab-12-3" class="">Lab 12-3 (Lab12-03.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter12/#lab-12-4" class="">Lab 12-4 (Lab12-04.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">💥 13. Data Encoding</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter13/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter13/#lab-13-1" class="">Lab 13-1 (Lab13-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter13/#lab-13-2" class="">Lab 13-2 (Lab13-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter13/#lab-13-3" class="">Lab 13-3 (Lab13-03.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🔎 14. Malware-Focussed Network Signatures</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter14/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter14/#lab-14-1" class="">Lab 14-1 (Lab14-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter14/#lab-14-2" class="">Lab 14-2 (Lab14-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter14/#lab-14-3" class="">Lab 14-3 (Lab14-03.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🚫 15. Anti-Disassembly</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter15/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter15/#lab-15-1" class="">Lab 15-1 (Lab15-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter15/#lab-15-2" class="">Lab 15-2 (Lab15-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter15/#lab-15-3" class="">Lab 15-3 (Lab15-03.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">❎ 16. Anti-Debugging</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter16/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter16/#lab-16-1" class="">Lab 16-1 (Lab16-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter16/#lab-16-2" class="">Lab 16-2 (Lab16-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter16/#lab-16-3" class="">Lab 16-3 (Lab16-03.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">📵 17. Anti-Virtual Machine Techniques</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter17/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter17/#lab-17-1" class="">Lab 17-1 (Lab17-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter17/#lab-17-2" class="">Lab 17-2 (Lab17-02.dll)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter17/#lab-17-3" class="">Lab 17-3 (Lab17-03.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🔳 18. Packers and Unpacking</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter18/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter18/#lab-18-1" class="">Lab 18-1 (Lab18-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter18/#lab-18-2" class="">Lab 18-2 (Lab18-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter18/#lab-18-3" class="">Lab 18-3 (Lab18-03.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter18/#lab-18-4" class="">Lab 18-4 (Lab18-04.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter18/#lab-18-5" class="">Lab 18-5 (Lab18-05.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🐢 19. Shellcode Analysis</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter19/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter19/#lab-19-1" class="">Lab 19-1 (Lab19-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter19/#lab-19-2" class="">Lab 19-2 (Lab19-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter19/#lab-19-3" class="">Lab 19-3 (Lab19-03.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🌊 20. C++ Analysis</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter20/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter20/#lab-20-1" class="">Lab 20-1 (Lab20-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter20/#lab-20-2" class="">Lab 20-2 (Lab20-02.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter20/#lab-20-3" class="">Lab 20-3 (Lab20-03.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🌌 21. 64-Bit Malware</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter21/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter21/#lab-21-1" class="">Lab 21-1 (Lab21-01.exe)</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter21/#lab-21-2" class="">Lab 21-2 (Lab21-02.exe)</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">🎁 Conclusion</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Conclusion/" class="">Start</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Conclusion/#extra---yara-malware-identification" class="">YARA: Malware Identification</a></li>
          
            
            

            
            

            <li><a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Conclusion/#tutorial-conclusion" class="">Tutorial Conclusion</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
    
  
  </div>


  <article class="page" itemscope="" itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Practical Malware Analysis - Chapter 11 Lab Write-up">
    <meta itemprop="description" content="This details reverse engineering activities and answers for labs contained in the book ‘Practical Malware Analysis’ by Michael Sikorski and Andrew Honig, which is published by No Starch Press.">
    <meta itemprop="datePublished" content="June 05, 2021">
    <meta itemprop="dateModified" content="November 13, 2023">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Practical Malware Analysis - Chapter 11 Lab Write-up
</h1>
          
            <p class="page__meta"><svg class="svg-inline--fa fa-clock fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="clock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg><!-- <i class="far fa-clock" aria-hidden="true"></i> --> 




  18 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/PMALabCHAPTER11.JPG" alt="PMALab" class="align-center"></p>

<h1 id="chapter-11-malware-behavior">Chapter 11. Malware Behavior</h1>

<p>Types of malware behaviors:</p>

<ul>
  <li>Downloaders and Launchers</li>
  <li>Backdoors</li>
  <li>Credential Stealers</li>
  <li>Persistence Mechanisms</li>
  <li>Privilege Escalation</li>
  <li>User-Mode Rootkits</li>
  <li>Keylogging</li>
</ul>

<h2 id="lab-11-1">Lab 11-1</h2>

<p>Analyze the malware found in Lab11-01.exe</p>

<h3 id="question-1">Question 1</h3>

<p class="notice--info">What does the malware drop to disk?</p>

<h3 id="answer-1">Answer 1</h3>

<p>By examining the binary using PEview, we can see that it contains imports to do with reading from its resource sections, writing a file to disk, and also contains an unusual import which is tagged as a binary.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot01.jpg" alt="Lab11-1.exe"></p>

<p>Based on this we can assume it will drop a file to disk. By examining strings of the binary, we can see reference to ‘MSGina.dll’ and a registry key location that leads us to believe this may drop a credential stealer designed for Windows 2000, XP, or Server 2003. This conclusion is drawn as ‘GINA” stands for ‘graphical identification and authentication’ which is a component of these older operating systems. GINA Interception is a known technique for harvesting credentials.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot02.jpg" alt="Lab11-1.exe"></p>

<p>By using Procmon, we can see that this drops msgina32.dll to disk before setting up a registry key to specify the custom GINA DLL be used during logon.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot03.jpg" alt="Lab11-1.exe"></p>

<h3 id="question-2">Question 2</h3>

<p class="notice--info">How does the malware achieve persistence?</p>

<h3 id="answer-2">Answer 2</h3>

<p>As shown above persistence is achieved by registering msgina32.dll, which is pulled from its resource section, as a custom GINA DLL in the Windows Registry at the below location:</p>

<ul>
  <li>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL</li>
</ul>

<p>By examining the documentation on <a href="https://docs.microsoft.com/en-us/windows/win32/secauthn/gina">GINA</a>, we can see that this is loaded into winlogon, and can have credentials passed through it that can be captured.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot04.jpg" alt="Lab11-1.exe"></p>

<p>One of the methods of doing this is to implement the WlxLoggedOutSAS which will be passed user credentials whenever someone tries to logon at the logon screen.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot05.jpg" alt="Lab11-1.exe"></p>

<h3 id="question-3">Question 3</h3>

<p class="notice--info">How does the malware steal user credentials?</p>

<h3 id="answer-3">Answer 3</h3>

<p>By using CFF Explorer VIII we can see that msgina32.dll exports a number of functions that correlate to known functions that need to be exported by a legitimate GINA DLL as it is prepended with Wlx.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot06.jpg" alt="msgina32.dll"></p>

<p>By looking at the strings on this DLL we can see that it contains a couple of interesting strings that look to be formatting related, and reference to msutil32.sys which we haven’t seen used.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot07.jpg" alt="msgina32.dll"></p>

<p>Opening this up in IDA, we can use msutil32.sys as a pivot point by looking for it in the code. Upon finding it we can use CTRL + X to find cross references to the function using this string which may give us more context into what it’s used for.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot08.jpg" alt="msgina32.dll"></p>

<p>Immediately we can see that this calls _wfopen which indicates there’s a file by the name msutil32.sys which will be opened. Examining the reference to this function gives us the impression that the below formatted string will be written to the file msutil32.sys</p>

<ul>
  <li>UN %s DM %s PW %s OLD %s</li>
</ul>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot09.jpg" alt="msgina32.dll"></p>

<p>It should be noted that %s will be replaced with the appropriate dynamic strings pushed to the stack. Of interest is that this has come from the function ‘WlxLoggedOutSAS’. Looking at what arguments are passed to this function leads us to an interesting discovery.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot10.jpg" alt="msgina32.dll"></p>

<p>Looking at documentation of this function, ‘pNprNotifyInfo’ which is passed to WlxLoggedOutSAS points to a structure that contains Domain, Username, and Password information for a user. This leads us to believe that this malware steals user credentials by using a custom GINA DLL which intercepts user passwords when no user is logged on.</p>

<h3 id="question-4">Question 4</h3>

<p class="notice--info">What does the malware do with stolen credentials?</p>

<h3 id="answer-4">Answer 4</h3>

<p>Looking back at sub_10001570 it appears that this is getting the date, time, and another value which it is being place inside of msutil32.sys in addition to a new line character.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot11.jpg" alt="msgina32.dll"></p>

<p>Based on what we see of this function the final value being written to this file is the contents passed by the calling function: UN %s DM %s PW %s OLD %s.</p>

<p>Placing all of this together we can make the informed decision that the malware will create a file called msutil32.sys which will contain the date, time, Domain, Username, and Password of a particular user every time a call is made to the exported function WlxLoggedOutSAS of msgina32.dll. Because this will be run by winlogon.exe we can expect this to fall within the directory C:\Windows\System32.</p>

<h3 id="question-5">Question 5</h3>

<p class="notice--info">How can you use this malware to get user credentials from your test environment?</p>

<h3 id="answer-5">Answer 5</h3>

<p>Because GINA DLLs are ignored in Windows Vista and later, this will only work in Windows XP or prior. Once the GINA DLL has been installed the system needs to be restarted. This is to ensure the new GINA DLL will be loaded into Winlogon.</p>

<p>Upon restarting and logging in we can see a new file is created.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot12.jpg" alt="msgina32.dll"></p>

<p>At this point we can confirm it has logged some relevant information as expected, and because no password was present it hasn’t logged an entry for ‘PWD’. If we log out and back in we can see a new entry has been added. By changing our password to ‘password’, logging out, and logging in we can see that the new credentials have been logged by this stealthy credential stealer.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot13.jpg" alt="msgina32.dll"></p>

<p>At this point we know how the GINA DLL functions and where it stores credentials.</p>

<h2 id="lab-11-2">Lab 11-2</h2>

<p>Analyze the malware found in Lab11-02.dll. Assume that a suspicious file named Lab11-02.ini was also found with this malware.</p>

<h3 id="question-1-1">Question 1</h3>

<p class="notice--info">What are the exports for this DLL malware?</p>

<h3 id="answer-1-1">Answer 1</h3>

<p>Instead of using the same tools we’ve looked at, we examine another tool called <a href="https://www.mzrst.com/">PPEE (puppy)</a> to get this information.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot01(1).jpg" alt="Lab11-02.dll"></p>

<p>Based on the above we can see that this only has one export ‘installer’.</p>

<h3 id="question-2-1">Question 2</h3>

<p class="notice--info">What happens after you attempt to install this malware using rundll32.exe?</p>

<h3 id="answer-2-1">Answer 2</h3>

<p>Given that this is a DLL which exports the function ‘installer’, we can use rundlle32.exe to run this exported function with the below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rundll32.exe Lab11-02.dll,installer
</code></pre></div></div>

<p>By running procmon with a filter looking for only events from rundll32, we can then run this and see 311 events have been generated in our Windows 7 VM.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot02(1).jpg" alt="Lab11-02.dll"></p>

<p>Naturally there’s a lot of requests that we won’t be interested in. One way to reduce the number of irrelevant entries is to add a filter that only shows operations that contain the words ‘set’ or ‘create’. Although this may seem like we miss out on interesting file reads, the ‘CreateFile’ API call is used both in file or I/O creation, or reading. This gives us coverage of these interesting events. By making this change we’re reduced to 99 entries.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot03(1).jpg" alt="Lab11-02.dll"></p>

<p>From the above we can see 3 main entries of interest. The first is that it issues a CreateFile API call to the below:</p>

<ul>
  <li>C:\Windows\System32\Lab11-02.ini</li>
</ul>

<p>Because we know that the CreateFile can be used for either creating or reading a file, we can look a little bit deeper at the properties of this event. By doing this we see that it is only looking to open the file with read privileges, rather than write to it.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot04(1).jpg" alt="Lab11-02.dll"></p>

<p>If you compare this to the event for CreateFile on the below, we can see that</p>

<ul>
  <li>C:\Windows\System32\spoolvxx32.dll</li>
</ul>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot05(1).jpg" alt="Lab11-02.dll"></p>

<p>In addition to this the malware attempts to add an entry to add the above DLL into ‘AppInit_DLLs’ within the registry. If we take a look into this and the security <a href="https://docs.microsoft.com/en-us/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2">implementations added to Windows 7</a>, we can gather that this is used to load the specified DLL into every user mode process on the system; however, because this is designed for Windows XP, there’s no modification to ‘RequireSignedAppInit_DLLs’ which is required to allow unsigned modules from being loaded in this manner.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot06(1).jpg" alt="Lab11-02.dll"></p>

<h3 id="question-3-1">Question 3</h3>

<p class="notice--info">Where must Lab11-02.ini reside in order for the malware to install properly?</p>

<h3 id="answer-3-1">Answer 3</h3>

<p>Based on the above analysis we can conclude that Lab11-02.ini must reside at C:\Windows\System32\Lab11-02.ini for the malware to install itself. Given this is on a Windows 7 system which introduces code signing requirements (without a registry modification) then this installation won’t be truly successful, even if you are running it as an administrator. From this we know that this was likely created with a target of Windows XP or older in mind.</p>

<h3 id="question-4-1">Question 4</h3>

<p class="notice--info">How is this malware installed for persistence?</p>

<h3 id="answer-4-1">Answer 4</h3>

<p>Based on the analysis in question 2, the malware installs itself as an AppInit_DLL for persistence which then means it will be loaded into any user mode process (anything that loads a user interface e.g. using User32.dll) on a system making it difficult to fully remove if every user process is running the malware. This has publicly been reported as a tactic used (even in 2020) by nation state and cyber criminals. If we open this up in IDA and view the exported installer function we can see evidence that backs up what we’ve seen.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot07(1).jpg" alt="Lab11-02.dll"></p>

<h3 id="question-5-1">Question 5</h3>

<p class="notice--info">What user-space rootkit technique does this malware employ?</p>

<h3 id="answer-5-1">Answer 5</h3>

<p>To understand this we first need to take a look at this in IDA to get an idea of its functions. Using CTRL + F12 to view the call flow of this DLL is an excellent way to get an idea of its functions.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot08(1).jpg" alt="Lab11-02.dll"></p>

<p>From this we can see that installer doesn’t seem to perform many more calls than what we’ve already identified. Of interest is that DllMain seems to have a number of extra calls, so we’ll look further into that. In particular the subroutine sub_100014B6 seems to make the most calls and is worth investigating.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot09(1).jpg" alt="Lab11-02.dll"></p>

<p>If we examine this subroutine we can see that it contains a number of checks which appear to be looking for a specific process name.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot10(1).jpg" alt="Lab11-02.dll"></p>

<p>Where the DLL is running inside of a process with any of the below names:</p>

<ul>
  <li>MSIMN.exe</li>
  <li>THEBAT.exe</li>
  <li>OUTLOOK.exe</li>
</ul>

<p>The DLL will proceed to call the below subroutines.</p>

<ul>
  <li>sub_100013BD</li>
  <li>sub_100012A3</li>
  <li>sub_10001499</li>
</ul>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot11(1).jpg" alt="Lab11-02.dll"></p>

<p>Of interest is that we can see reference to ‘send’ and ‘wsock32.dll’. Examining sub_100012A3 more closely, we can begin to see evidence that this gets a handle on wsock32.dll before GetProcAddress is used to get the send function of this DLL before passing them to sub_10001203.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot12(1).jpg" alt="Lab11-02.dll"></p>

<p>Based on this it looks like the program is using inline hooking via this DLL as a form of user-space rootkit. The hooking code looks to primarily be installed from within ‘sub_10001203’.</p>

<h3 id="question-6">Question 6</h3>

<p class="notice--info">What does the hooking code do?</p>

<h3 id="answer-6">Answer 6</h3>

<p>Examining ‘sub_10001203’ there’s a number of operations which occur due to the complexities of adding an inline hook.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot13(1).jpg" alt="Lab11-02.dll"></p>

<p>Essentially this installation will calculate the correct jump address before modifying memory protections so that the ‘send’ function can be changed. This then creates a trampoline which will preserve the first 5 bytes of the send instruction, prior to overwriting these 5 bytes with the JMP instruction to what is now located in var_4. To understand what’s in var_4 we need to look back at what is being passed to this hook installation, as this is what is performing the hook function.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot14.jpg" alt="Lab11-02.dll"></p>

<p>Based on this we can infer that ‘sub_1000113D’ and ‘dword_10003484’ are being sent as part of the hooking function and should be analysed. A quick look at sub_1000113D reveals similarities with the ‘send’ function. Because this needs to implement the same arguments as the send function it can be defined by setting the function type.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot15.jpg" alt="Lab11-02.dll"></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int __stdcall sub_1000113D(SOCKET s, char * buf, int len, int flags)
</code></pre></div></div>

<p>This makes it a little bit clearer. Looking at it we can see that it seems to be modifying in memory specified recipients by adding an entry involving ‘RCPT TO:’ and an unknown value specified by ‘byte_100034A0’.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot16.jpg" alt="Lab11-02.dll"></p>

<p>To get more context on what this will contain we need to look for the operation which reads bytes into this offset.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot17.jpg" alt="Lab11-02.dll"></p>

<p>Examining the main function which adds elements to this we can see that the data is pulled from Lab11-02.ini before calling the subroutine ‘sub_100010B3’.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot18.jpg" alt="Lab11-02.dll"></p>

<p>Looking at the contents of Lab11-02.ini, we see that it looks to be ‘gibberish’ or more likely that some type of encoding is being used, which leads us to believe that ‘sub_100010B3’ may be a decoding routine.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot19.jpg" alt="Lab11-02.dll"></p>

<p>We will examine this further in question 8.</p>

<h3 id="question-7">Question 7</h3>

<p class="notice--info">Which process(es) does this malware attack and why?</p>

<h3 id="answer-7">Answer 7</h3>

<p>Based on our analysis in Question 5 and 6, this malware only attacks the below processes.</p>

<ul>
  <li>MSIMN.exe</li>
  <li>THEBAT.exe</li>
  <li>OUTLOOK.exe</li>
</ul>

<p>This is because they are specific email clients and this malware is designed to hook a specific API call only for the specified email clients.</p>

<h3 id="question-8">Question 8</h3>

<p class="notice--info">What is the significance of the .ini file?</p>

<h3 id="answer-8">Answer 8</h3>

<p>Revisiting sub_100010B3 we’re under the impression it performs some decoding. Given this is quite challenging to work through manually in IDA, we move back to OllyDbg to perform some dynamic analysis of this subroutine. We’re able to do this by using the ‘loaddll’ binary.</p>

<p>By jumping to ‘0x100016CA’ which is what calls this suspected decoding routine and creating a breakpoint at the function, and directly after the function, we can then copy ‘Lab11-02.ini’ to C:\Windows\System32 where we know it is attempted to be loaded from. Running the program we hit our breakpoint.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot20.jpg" alt="Lab11-02.dll"></p>

<p>By stepping over this routine ensuring that the second breakpoint has been added, we can now see the below value appear on the stack.</p>

<ul>
  <li>billy@malwareanalysisbook.com</li>
</ul>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot21.jpg" alt="Lab11-02.dll"></p>

<p>This leads us to believe that the .ini file is encoded and once decoded is used to specify an email which based on our analysis in question 6 will be added to any email sent as a secondary recipient based on the hooked send function.</p>

<h3 id="question-9">Question 9</h3>

<p class="notice--info">How can you dynamically capture this malware’s activity with Wireshark?</p>

<h3 id="answer-9">Answer 9</h3>

<p>To do this we setup a host-only (networking) adapter in our VM, and then begin capturing packets on this adapter in Wireshark.</p>

<p>After this we run the installation function of the malware with the below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rundll32.exe Lab11-02.dll,installer
</code></pre></div></div>

<p>From here we open up Outlook Express in our VM and set an appropriate account up to send emails from. We’re going to need to set this up with the IP address of our host OS.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Tools &gt; Accounts &gt; Mail
</code></pre></div></div>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot22.jpg" alt="Lab11-02.dll"></p>

<p>From here on our host OS we can setup a fake smtp daemon debugging server to receive emails with the below (substituting the IP as required).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo python -m smtpd -n -c DebuggingServer 192.168.0.17:25
</code></pre></div></div>

<p>From here if we run Wireshark on this adapter and send an email we can see it is received by our server.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot23.jpg" alt="Lab11-02.dll"></p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot24.jpg" alt="Lab11-02.dll"></p>

<p>If we take a look at Wireshark we can see the modification of recipients has occurred and it is now also sending an email to <a href="mailto:billy@malwareanalysisbook.com">billy@malwareanalysisbook.com</a>.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot25.jpg" alt="Lab11-02.dll"></p>

<h2 id="lab-11-3">Lab 11-3</h2>

<p>Analyze the malware found in Lab11-03.exe and Lab11-03.dll. Make sure that both files are in the same directory during analysis.</p>

<h3 id="question-1-2">Question 1</h3>

<p class="notice--info">What interesting analysis leads can you discover using basic static analysis?</p>

<h3 id="answer-1-2">Answer 1</h3>

<p>If we run strings over Lab11-03.exe we can see a number of strings which relate to loading a library (DLL), manipulating (starting) a service called ‘cisvc’ (a quick search reveals this is the content index service), and reference to a non-existant DLL ‘inet_epar32.dll’.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot01(2).jpg" alt="Lab11-03.exe"></p>

<p>In addition this contains references to ‘VirtualAlloc’, ‘HeapAlloc’, and ‘VirtualFree’ which seems to indicate this will manipulate memory in some fashion. It should be noted that memory manipulation using API’s such as ‘VirtualAlloc’ or ‘VirtualAllocEx’ is often used when injecting shellcode into a process.</p>

<p>If we run strings over Lab11-03.dll we can once again see a number of strings of interest. We can see there’s once again an entry for a non-existant DLL, and an entry for ‘GetAyncKeyState’ which is commonly used in keyloggers.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot02(2).jpg" alt="Lab11-03.exe"></p>

<p>What leads us to believe this may be a keylogger even more is that it has a specific string for ‘<shift>' in addition to writing output to a file. The explicit '<shift>' declaration is common amongst keyloggers as they need a way of determining if a key pressed is capitalised or not. The same applies for a number of supporting keys such as '<backspace>'.</backspace></shift></shift></p>

<h3 id="question-2-2">Question 2</h3>

<p class="notice--info">What happens when you run this malware?</p>

<h3 id="answer-2-2">Answer 2</h3>

<p>If we run Procmon to analyse what happens with this malware is run, we can see that it looks to query Lab11-03.dll prior to creating (and then writing) a file to: C:\WINDOWS\sytem32\inet_epar32.dll, this leads us to believe it’s copied Lab11-03.dll to this location. In addition this gets Generic Read/Write access to C:\WINDOWS\sytem32\cisvc.exe, but doesn’t perform any type of file write operations.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot03(2).jpg" alt="Lab11-03.exe"></p>

<p>Because we suspect this may have keylogging functionality, we begin typing some text in any application. In addition we expand our procmon search to include any process with the name cisvc.exe, given this seems to be accessed so may hold more information. What immediately is shown is that cisvc seems to look at files from our previous lab11-02, in addition to loading the copied ‘inet_epar32.dll’ file, and creating a file at ‘C:\WINDOWS\sytem32\kernel64x.dll’.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot04(2).jpg" alt="Lab11-03.exe"></p>

<p>By cross examining the file written by this with the legitimate ‘kernel32.dll’, we can see a number of glaring differences that would indicate this isn’t likely a legitimate DLL. Opening this in notepad confirms that it is indeed logging applications as they shift focus, and appears to be logging keystrokes.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot05(2).jpg" alt="Lab11-03.exe"></p>

<h3 id="question-3-2">Question 3</h3>

<p class="notice--info">How does Lab11-03.exe persistently install Lab11-03.dll?</p>

<h3 id="answer-3-2">Answer 3</h3>

<p>First we take a look at Lab11-03.exe using IDA. Examining the main method it appears as there’s only a couple of custom function calls which leads us to believe the program may be basic.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot06(2).jpg" alt="Lab11-03.exe"></p>

<p>When we graph the call flow of this application we can see that it’s far more complicated than we initially thought with many functions being nested.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot07(2).jpg" alt="Lab11-03.exe"></p>

<p>Drilling into this we first look at the cross references to ‘sub_401070’ which is called prior to starting ‘cisvc’.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot08(2).jpg" alt="Lab11-03.exe"></p>

<p>Based on the windows API calls we can assume that a file is being mapped into memory (C:\WINDOWS\sytem32\cisvc.exe) with functions occurring on the file prior to UnmapViewOfFile is called which writes the file changes ‘lazily’ to disk.</p>

<p>By examining ‘sub_401070’ more in depth we can see that a number of checks occur based on getting a handle on the file in question, memory, and the binary itself; however if these checks are passed an operation occurs in the bottom right of this flow at ‘loc_40127C’ which is of interest.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot09(2).jpg" alt="Lab11-03.exe"></p>

<p>This function is of interest because it uses ‘lpBaseAddress’ to get the base address of the mapped file C:\WINDOWS\sytem32\cisvc.exe and has clear modifications occurring prior to ‘UnmapViewOfFile’ being called.</p>

<p>The function uses an unknown variable of ‘var_28’ as an offset from this base before the counter register (ECX) is set to 4Eh (78 in Hex). As the action occurring is ‘MOVSD’ (Move String, Double Word) using this counter register, we know that this is moving 78 DWORDs starting at ‘byte_409030’. At this point it’s important to note that a DWORD is a 32-bit (4-byte) unsigned integer. Due to this the total number of bytes that will be copied is 78 * 4 = 312 bytes. Examining ‘byte_409030’ we see some entries that don’t make a lot of sense.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot10(2).jpg" alt="Lab11-03.exe"></p>

<p>This is shellcode that will be copied directly as assembly to the binary in question and is stored in Hex. Using ‘c’ we can convert this directly to code to see what it is performing. First we look through to see if there’s any obvious strings. At ‘00409139’ and ‘0040915D’ we find some strings of interest if we convert them to ASCII using ‘A’.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot11(2).jpg" alt="Lab11-03.exe"></p>

<p>Based on this and the activity we saw running the program we begin to infer that the shellcode will likely dynamically load ‘C:\WINDOWS\System32\inet_epar32.dll’ and run the export ‘zzz69806582’. Looking at the exports of ‘Lab11-03.dll’ which we know is copied to this location, we can see this is a valid export.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot12(2).jpg" alt="Lab11-03.exe"></p>

<p>Given ‘zzz69806582’ is an obvious unique string we can use this as a pivot point to open the executable in a program such as ‘HxD’ and find the appropriate shellcode for exporting. We also do this by looking for the expected Hex.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot13(2).jpg" alt="Lab11-03.exe"></p>

<p>After saving the shellcode to a new file (Lab11-3Shellcode.dat) by copying it to a new file using HxD, we can now use a shellcode debugging tool (scdbg) to confirm what actions were taken by the shellcode we’ve found.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scdbg -findsc -f Lab11-3Shellcode.dat
</code></pre></div></div>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot14(1).jpg" alt="Lab11-03.exe"></p>

<p>Although an error occurs as we wind up looking into invalid memory, we’re successfully able to step over enough of the shellcode to reveal that it is using ‘LoadLibraryExA’ to load in C:\WINDOWS\System32\inet_epar32.dll, before using ‘GetProcAddress’ to get the exported function ‘zzz69806582’.</p>

<p>Based on this we conclude that Lab11-03.exe will persistently install Lab11-03.dll by infecting the indexing service binary C:\WINDOWS\sytem32\cisvc.exe to run shellcode that uses ‘LoadLibraryExA’ and ‘GetProcAddress’ to load ‘C:\WINDOWS\System32\inet_epar32.dll’ and run the export ‘zzz69806582’ from this DLL.</p>

<h3 id="question-4-2">Question 4</h3>

<p class="notice--info">Which Windows system file does the malware infect?</p>

<h3 id="answer-4-2">Answer 4</h3>

<p>Based on the above analysis we can conclude that this malware infects the indexing service binary C:\WINDOWS\sytem32\cisvc.exe</p>

<h3 id="question-5-2">Question 5</h3>

<p class="notice--info">What does Lab11-03.dll do?</p>

<h3 id="answer-5-2">Answer 5</h3>

<p>Examining Lab11-03.dll in IDA, we start with the export we identified from our previous shellcode analysis (zzz69806582)/</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot15(1).jpg" alt="Lab11-03.dll"></p>

<p>This doesn’t perform much except creating a thread to run actions specified in ‘StartAddress’, so we examine this subroutine for more information. By graphing the user defined cross references to this subroutine we can get an idea of what this may be trying to accomplish.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot16(1).jpg" alt="Lab11-03.dll"></p>

<p>Based on the Windows API calls we begin to get the feeling that this acts as a keylogger that will create a file if it doesn’t exist, open a mutex to ensure only one instance of it is running, calls ‘GetAsyncKeyState’ to log keystrokes, and writes these to a file before sleeping for a period of time and repeating (this would simulate a poll that occurs on a schedule). To confirm this we look closer at what is occurring at ‘0x10001410’.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot17(1).jpg" alt="Lab11-03.dll"></p>

<p>Based on this we can determine that the malware creates a Mutex ‘MZ’ and file at ‘C:\WINDOWS\sytem32\kernel64x.dll’. Drilling into the subroutine at ‘sub_10001380’,</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot18(1).jpg" alt="Lab11-03.dll"></p>

<p>Here we can see evidence of information being written to this file before a timeout of ‘0A’ (10) milliseconds occur and it repeats. We can also see evidence of another subroutine being called at ‘sub_10001030’ and if we look into this we can see lots of evidence it is being used as a keylogger. Based on GetAsyncKeyState being used, we can look into <a href="https://docs.microsoft.com/en-us/windows/win32/inputdev/virtual-key-codes">Virtual-Key Codes</a> to get an idea of what this is checking for before logging the character “&lt;SHIFT&gt;”.</p>

<p><img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/Screenshot19(1).jpg" alt="Lab11-03.dll"></p>

<p>From this context we can infer that Lab11-03.dll is a keylogger which polls frequently and writes keys pushed to C:\WINDOWS\sytem32\kernel64x.dll.</p>

<h3 id="question-6-1">Question 6</h3>

<p class="notice--info">Where does the malware store the data it collects?</p>

<h3 id="answer-6-1">Answer 6</h3>

<p>Based on the above analysis we can confirm that this malware stores keystrokes and window information it collects at ‘C:\WINDOWS\sytem32\kernel64x.dll’.</p>

<p>This concludes chapter 11, <a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter12/">proceed to the next chapter</a>.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><svg class="svg-inline--fa fa-tags fa-w-20 fa-fw" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg><!-- <i class="fas fa-fw fa-tags" aria-hidden="true"></i> --> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://www.jaiminton.com/tags/#appinit-dlls" class="page__taxonomy-item" rel="tag">AppInit_DLLs</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#cff-explorer-viii" class="page__taxonomy-item" rel="tag">CFF Explorer VIII</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#credential-stealer" class="page__taxonomy-item" rel="tag">Credential Stealer</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#debugging" class="page__taxonomy-item" rel="tag">Debugging</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#dynamic-malware-analysis" class="page__taxonomy-item" rel="tag">Dynamic Malware Analysis</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#graphical-identification-and-authentication-gina" class="page__taxonomy-item" rel="tag">Graphical Identification and Authentication (GINA)</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#hooking" class="page__taxonomy-item" rel="tag">Hooking</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#hxd" class="page__taxonomy-item" rel="tag">HxD</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#ida-pro" class="page__taxonomy-item" rel="tag">IDA Pro</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#injector" class="page__taxonomy-item" rel="tag">Injector</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#keylogger" class="page__taxonomy-item" rel="tag">Keylogger</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#malware-analysis" class="page__taxonomy-item" rel="tag">Malware Analysis</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#masquerading" class="page__taxonomy-item" rel="tag">Masquerading</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#mutex" class="page__taxonomy-item" rel="tag">Mutex</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#no-starch-press" class="page__taxonomy-item" rel="tag">No Starch Press</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#ollydbg" class="page__taxonomy-item" rel="tag">OllyDbg</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#pe-bear" class="page__taxonomy-item" rel="tag">PE-bear</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#peview" class="page__taxonomy-item" rel="tag">PEview</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#pma" class="page__taxonomy-item" rel="tag">PMA</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#process-monitor-procmon" class="page__taxonomy-item" rel="tag">Process Monitor (Procmon)</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#process-monitor-procmon" class="page__taxonomy-item" rel="tag">Process Monitor (Procmon)</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#professional-pe-file-explorer-ppee-puppy" class="page__taxonomy-item" rel="tag">Professional PE file Explorer - PPEE (Puppy)</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#rootkit" class="page__taxonomy-item" rel="tag">Rootkit</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#rundll32" class="page__taxonomy-item" rel="tag">Rundll32</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#scdbg" class="page__taxonomy-item" rel="tag">Scdbg</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#shellcode" class="page__taxonomy-item" rel="tag">Shellcode</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#smtp-daemon" class="page__taxonomy-item" rel="tag">SMTP Daemon</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#static-malware-analysis" class="page__taxonomy-item" rel="tag">Static Malware Analysis</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#stdcall" class="page__taxonomy-item" rel="tag">stdcall</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#strings" class="page__taxonomy-item" rel="tag">Strings</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#wireshark" class="page__taxonomy-item" rel="tag">Wireshark</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/tags/#x86-disassembly" class="page__taxonomy-item" rel="tag">x86 Disassembly</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><svg class="svg-inline--fa fa-folder-open fa-w-18 fa-fw" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="folder-open" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z"></path></svg><!-- <i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> --> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://www.jaiminton.com/categories/#practicalmalwareanalysis" class="page__taxonomy-item" rel="tag">PracticalMalwareAnalysis</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/categories/#reverse-engineering" class="page__taxonomy-item" rel="tag">Reverse Engineering</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/categories/#tutorials" class="page__taxonomy-item" rel="tag">Tutorials</a><span class="sep">, </span>
    
      
      
      <a href="https://www.jaiminton.com/categories/#windows" class="page__taxonomy-item" rel="tag">Windows</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><svg class="svg-inline--fa fa-calendar-alt fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="calendar-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"></path></svg><!-- <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> --> Updated:</strong> <time datetime="2023-11-13">November 13, 2023</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=CyberRaiju&amp;text=Practical+Malware+Analysis+-+Chapter+11+Lab+Write-up%20https%3A%2F%2Fwww.jaiminton.com%2FTutorials%2FPracticalMalwareAnalysis%2FChapter11%2F" class="btn btn--twitter" onclick="window.open(this.href, &#39;window&#39;, &#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0&#39;); return false;" title="Share on Twitter"><svg class="svg-inline--fa fa-twitter fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><!-- <i class="fab fa-fw fa-twitter" aria-hidden="true"></i> --><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.jaiminton.com%2FTutorials%2FPracticalMalwareAnalysis%2FChapter11%2F" class="btn btn--facebook" onclick="window.open(this.href, &#39;window&#39;, &#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0&#39;); return false;" title="Share on Facebook"><svg class="svg-inline--fa fa-facebook fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z"></path></svg><!-- <i class="fab fa-fw fa-facebook" aria-hidden="true"></i> --><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.jaiminton.com%2FTutorials%2FPracticalMalwareAnalysis%2FChapter11%2F" class="btn btn--linkedin" onclick="window.open(this.href, &#39;window&#39;, &#39;left=20,top=20,width=500,height=500,toolbar=1,resizable=0&#39;); return false;" title="Share on LinkedIn"><svg class="svg-inline--fa fa-linkedin fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg><!-- <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> --><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter10/" class="pagination--pager" title="Practical Malware Analysis - Chapter 10 Lab Write-up
">Previous</a>
    
    
      <a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis/Chapter12/" class="pagination--pager" title="Practical Malware Analysis - Chapter 12 Lab Write-up
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/LummaC2.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://www.jaiminton.com/reverse-engineering/lummac2" rel="permalink">LummaC2 - Malware Analysis Lab
</a>
      
    </h2>
    
      <p class="page__meta"><svg class="svg-inline--fa fa-clock fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="clock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg><!-- <i class="far fa-clock" aria-hidden="true"></i> --> 




  30 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Analysis of a RAR file which leads to the discovery of malicious Github repositories designed to distribute malware.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/formbookdownloader.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://www.jaiminton.com/reverse-engineering/formbook-downloader" rel="permalink">FormBook Downloader - Malware Analysis Lab
</a>
      
    </h2>
    
      <p class="page__meta"><svg class="svg-inline--fa fa-clock fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="clock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg><!-- <i class="far fa-clock" aria-hidden="true"></i> --> 




  18 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Analysis of a LNK which acts as a FormBook download cradle hosted on a compromised WordPress website.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/amos-stealer.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://www.jaiminton.com/reverse-engineering/atomic-macos-stealer-amos" rel="permalink">Atomic MacOS Stealer (AMOS) - Malware Analysis Lab
</a>
      
    </h2>
    
      <p class="page__meta"><svg class="svg-inline--fa fa-clock fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="clock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg><!-- <i class="far fa-clock" aria-hidden="true"></i> --> 




  23 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Analysis of Atomic MacOS Stealer (AMOS) distributed through fake Homebrew domains
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/wasabiwallet.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://www.jaiminton.com/reverse-engineering/wasabi-cryptoshuffler-turs" rel="permalink">Cryptoshuffler/TURS Agent - Malware Analysis Lab
</a>
      
    </h2>
    
      <p class="page__meta"><svg class="svg-inline--fa fa-clock fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="clock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg><!-- <i class="far fa-clock" aria-hidden="true"></i> --> 




  19 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Analysis of a backoored Wasabi Wallet installer and how it deploys TURS Agent onto a system
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
    <div id="results" class="results"></div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://app.hackthebox.com/profile/10636" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-box fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="box" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M509.5 184.6L458.9 32.8C452.4 13.2 434.1 0 413.4 0H272v192h238.7c-.4-2.5-.4-5-1.2-7.4zM240 0H98.6c-20.7 0-39 13.2-45.5 32.8L2.5 184.6c-.8 2.4-.8 4.9-1.2 7.4H240V0zM0 224v240c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V224H0z"></path></svg><!-- <i class="fas fa-box" aria-hidden="true"></i> --> Hack The Box</a></li>
        
      
        
          <li><a href="https://twitter.com/CyberRaiju" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-twitter-square fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg><!-- <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> --> Twitter</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/JaiMinton" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-linkedin fa-w-14" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg><!-- <i class="fab fa-linkedin" aria-hidden="true"></i> --> LinkedIN</a></li>
        
      
        
          <li><a href="https://github.com/JPMinty" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-github fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-fw fa-github" aria-hidden="true"></i> --> GitHub</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@cyberraiju/featured" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-youtube fa-w-18 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg><!-- <i class="fab fa-fw fa-youtube" aria-hidden="true"></i> --> YouTube</a></li>
        
      
        
          <li><a href="https://infosec.exchange/@CyberRaiju" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-mastodon fa-w-14" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 417 512" data-fa-i2svg=""><path fill="currentColor" d="M417.8 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.5-28.4-290.4 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.4-.9-9-.9-13.9 85.6 20.9 158.6 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5h-46.3V197c0-58.5-64-56.6-64-6.9v114.2H75.1c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175z"></path></svg><!-- <i class="fab fa-mastodon" aria-hidden="true"></i> --> Mastodon</a></li>
        
      
        
      
        
      
    
  </ul>  
<div class="page__footer-copyright">© 2024 Jai Minton.</div>

      </div></footer>
    </div>
    <div>
    
  <script src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/main.min.js.download"></script>
  <script data-search-pseudo-elements="" defer="" src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/all.js.download" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>




<script src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/lunr.min.js.download"></script>
<script src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/lunr-store.js.download"></script>
<script src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/lunr-en.js.download"></script>



    </div>
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'894899a9ad813a42',t:'MTcxODUxNzg0My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/saved_resource.html"></iframe><script defer="" src="./Practical Malware Analysis - Chapter 11 Lab Write-up _ Jai Minton_files/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon="{&quot;rayId&quot;:&quot;894899a9ad813a42&quot;,&quot;r&quot;:1,&quot;version&quot;:&quot;2024.4.1&quot;,&quot;token&quot;:&quot;96762cd668614a10963969fc4e520d9b&quot;}" crossorigin="anonymous"></script>


</body></html>